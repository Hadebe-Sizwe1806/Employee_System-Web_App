@{
    ViewData["Title"] = "Employee Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .profile-card {
        border-radius: 8px;
        box-shadow: 0 1px 6px rgba(0,0,0,0.06);
        overflow: hidden;
    }

    .profile-photo {
        max-width: 140px;
        width: 100%;
        height: auto;
        border-radius: 8px;
        flex-shrink: 0;
    }

    .field-label {
        color: #333;
        font-weight: 600;
    }

    .small-muted {
        color: #6c757d;
        font-size: .9rem;
    }

    .profile-details {
        word-break: break-word;
        overflow-wrap: anywhere;
    }

    .profile-card .d-flex {
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
    }

    @Html.Raw("@media (max-width: 576px) { .profile-photo { max-width: 120px; margin-bottom: 8px; } } ")
</style>

<div class="container mt-4">
    <div class="row g-3">
        <div class="col-lg-6 offset-lg-3">
            <div class="card profile-card p-3">
                <div class="d-flex align-items-center">
                    <img id="pPhoto" src="" alt="Profile photo" class="profile-photo img-thumbnail" />
                    <div class="profile-details" style="min-width:0;margin-left:12px;">
                        <h5 id="pFullName" class="mb-1"><span id="pName"></span> <small id="pSurname"></small></h5>
                        <div class="small-muted"><span class="field-label">Role:</span> <span id="pRole"></span></div>
                        <div class="small-muted"><span class="field-label">Phone:</span> <span id="pPhone"></span></div>
                        <div class="small-muted"><span class="field-label">Email:</span> <span id="pEmail"></span></div>
                    </div>
                </div>

                <hr />

                <div>
                    <h6 class="mb-1">Quick actions</h6>
                    <div class="d-grid gap-2">
                        <button id="editProfileBtn" class="btn btn-primary">Edit Profile</button>
                        <a href="/Employee/Dashboard" class="btn btn-secondary mt-3">Back to dashboard</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="editProfileMsg" class="mb-2"></div>
        <div class="mb-3">
          <label class="form-label">Name</label>
          <input type="text" id="editName" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Surname</label>
          <input type="text" id="editSurname" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Role</label>
          <input type="text" id="editRole" class="form-control" />
        </div>
        <div class="mb-3">
          <label class="form-label">Phone</label>
          <input type="text" id="editPhone" class="form-control" />
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="saveProfileBtn" type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

@section Scripts {
    <script src="/js/employee-profile.js"></script>
    <script src="/js/logout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const signOut = document.getElementById('signOutBtn');
            if (signOut) signOut.addEventListener('click', async () => {
                if (window.firebaseHelpers && window.firebaseHelpers.auth) {
                    try {
                        await window.firebaseHelpers.auth.signOut();
                        window.location.href = '/';
                    } catch (e) {
                        console.error('Sign out failed', e);
                    }
                }
            });
        });
    </script>
}